#!/bin/sh
set -e

# If docker-machine exists,
# make sure the required environment variables are set for this script.
command -v docker-machine >/dev/null 2>&1 && eval $(docker-machine env default)

# Change into dev directory,
# so all following commands are run in the correct context.
USER_WORKING_DIR=$PWD
cd $(dirname $0)/..
DEVFILES_PATH=$PWD

# docker build -t graysonwright/fish docker/fish

docker run --rm -it \
  \
  -e HOME=$HOME \
  -e DEVFILES_PATH=$DEVFILES_PATH \
  -e XDG_CONFIG_HOME=/config \
  -e EDITOR=$DEVFILES_PATH/bin/vi \
  -e fish_user_paths=$DEVFILES_PATH/bin \
  \
  -v $HOME:$HOME \
  -v $DEVFILES_PATH/config:/config \
  -v $HOME/.ssh:/root/.ssh \
  -v /var/run/docker.sock:/var/run/docker.sock \
  \
  --workdir $USER_WORKING_DIR \
  \
  graysonwright/fish fish
